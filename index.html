<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube Viewer</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
    input[type="text"] { padding: 8px; width: 80%; max-width: 300px; }
    button { padding: 8px; }
    iframe { width: 100%; max-width: 560px; height: 315px; margin: 20px 0; }
    .video-list { display: flex; flex-wrap: wrap; justify-content: center; }
    .video-item { width: 160px; margin: 10px; cursor: pointer; text-align: left; }
    .video-item img { width: 100%; border-radius: 8px; }
    .video-item p { font-size: 0.9em; margin: 5px 0 0; }
    .loading { display: none; }
  </style>
</head>
<body>
  <h1>YouTube Viewer</h1>
  <input type="text" id="searchQuery" placeholder="Search for videos...">
  <button onclick="searchVideos()">Search</button>
  <h2>Now Playing</h2>
  <iframe id="player" src="" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
  <h2>Search Results</h2>
  <div id="searchResults" class="video-list"></div>
  <div class="loading" id="loading">Loading more videos...</div>
  <script>
    const API_KEY = 'AIzaSyDENcWyLqGvQ_xNI8E1noksTDurfV1fzpE'; // Thay bằng API key của bạn
    const player = document.getElementById('player');
    const searchResults = document.getElementById('searchResults');
    const loading = document.getElementById('loading');
    let nextPageToken = ''; // Biến lưu trữ mã token cho trang tiếp theo
    function searchVideos() {
      const query = document.getElementById('searchQuery').value;
      nextPageToken = ''; // Reset token khi tìm kiếm mới
      searchResults.innerHTML = ''; // Xóa danh sách video cũ
      fetchVideos(query); // Tìm kiếm video mới
    }
    function fetchVideos(query) {
      loading.style.display = 'block'; // Hiển thị thông báo đang tải
      fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&q=${encodeURIComponent(query)}&key=${API_KEY}&maxResults=10&pageToken=${nextPageToken}`)
        .then(response => response.json())
        .then(data => {
          loading.style.display = 'none'; // Ẩn thông báo tải
          if (data.items.length > 0) {
            data.items.forEach(item => {
              const videoItem = document.createElement('div');
              videoItem.className = 'video-item';
              videoItem.innerHTML = `
                <img src="${item.snippet.thumbnails.default.url}" alt="${item.snippet.title}">
                <p>${item.snippet.title}</p>
              `;
              videoItem.onclick = () => {
                playVideo(item.id.videoId);
                scrollToPlayer(); // Cuộn đến vị trí trình phát
              };
              searchResults.appendChild(videoItem);
            });
            nextPageToken = data.nextPageToken; // Cập nhật token cho trang tiếp theo
          }
        });
    }
    function playVideo(videoId) {
      player.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1&showinfo=0`; // Thêm tham số giảm thiểu quảng cáo
    }
    function scrollToPlayer() {
      // Cuộn đến vị trí trình phát video
      const yOffset = -100; // Khoảng cách cuộn lên (có thể điều chỉnh)
      const y = player.getBoundingClientRect().top + window.pageYOffset + yOffset;
      window.scrollTo({ top: y, behavior: 'smooth' });
    }
    // Theo dõi sự kiện cuộn để tải thêm video
    window.onscroll = function() {
      if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 100) {
        if (nextPageToken) { // Kiểm tra xem có token cho trang tiếp theo không
          fetchVideos(document.getElementById('searchQuery').value);
        }
      }
    };
  </script>
</body>
</html>
